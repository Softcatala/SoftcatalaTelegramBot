;(function (e) {
    var t = 60 * 1e3;
    var n = function (e) {
        return e.toISOString().replace(/-|:|\.\d+/g, "")
    };
    var r = function (e) {
        return e.end ? n(e.end) : n(new Date(e.start.getTime() + e.duration * t))
    };
    var i = {
        google: function (e) {
            var t = n(e.start);
            var i = r(e);
            var s = encodeURI(["https://www.google.com/calendar/render", "?action=TEMPLATE", "&text=" + (e.title || ""), "&dates=" + (t || ""), "/" + (i || ""), "&details=" + (e.description || ""), "&location=" + (e.address || ""), "&sprop=&sprop=name:"].join(""));
            return '<a class="icon-google" target="_blank" href="' + s + '" style="padding-bottom:15px;">Google Calendar</a>'
        }, yahoo: function (e) {
            var r = e.end ? (e.end.getTime() - e.start.getTime()) / t : e.duration;
            var i = r < 600 ? "0" + Math.floor(r / 60) : Math.floor(r / 60) + "";
            var s = r % 60 < 10 ? "0" + r % 60 : r % 60 + "";
            var o = i + s;
            var u = n(new Date(e.start - e.start.getTimezoneOffset() * t)) || "";
            var a = encodeURI(["http://calendar.yahoo.com/?v=60&view=d&type=20", "&title=" + (e.title || ""), "&st=" + u, "&dur=" + (o || ""), "&desc=" + (e.description || ""), "&in_loc=" + (e.address || "")].join(""));
            return '<a class="icon-yahoo" target="_blank" href="' + a + '" style="padding-bottom:15px;">Yahoo! Calendar</a>'
        }, ics: function (e, t, i) {
            var s = n(e.start);
            var o = r(e);
            var u = encodeURI("data:text/calendar;charset=utf8," + ["BEGIN:VCALENDAR", "VERSION:2.0", "BEGIN:VEVENT", "URL:" + document.URL, "DTSTART:" + (s || ""), "DTEND:" + (o || ""), "SUMMARY:" + (e.title || ""), "DESCRIPTION:" + (e.description || ""), "LOCATION:" + (e.address || ""), "END:VEVENT", "END:VCALENDAR"].join("\n"));
            return '<a class="' + t + '" target="_blank" href="' + u + '" style="padding-bottom:15px;">' + i + " Calendar</a>"
        }, ical: function (e) {
            return this.ics(e, "icon-ical", "iCal")
        }, outlook: function (e) {
            return this.ics(e, "icon-outlook", "Outlook")
        }
    };
    var s = function (e) {
        return {google: i.google(e), yahoo: i.yahoo(e), ical: i.ical(e), outlook: i.outlook(e)}
    };
    var o = function () {
        if (!document.getElementById("ouical-css")) {
            document.getElementsByTagName("head")[0].appendChild(u())
        }
    };
    var u = function () {
        var e = document.createElement("style");
        e.id = "ouical-css";
        e.innerHTML = "#add-to-calendar-checkbox-label{cursor:pointer}.add-to-calendar-checkbox~a, .add-to-calendar-checkbox:checked~a{display:block;width:200px;margin-left:20px}input[type=checkbox].add-to-calendar-checkbox{position:absolute;top:-9999px;left:-9999px;}.add-to-calendar-checkbox~a:before{width:40px;height:40px;display:inline-block;background-image:url('lib/calendars.png');margin-right:.5em;content:' '}.icon-ical:before{background-position:80px 40px}.icon-outlook:before{background-position:40px 40px}.icon-yahoo:before{background-position:120px 40px}.icon-google:before{background-position:0px 40px}";
        return e
    };
    var a = function (e) {
        return e.data !== undefined && e.data.start !== undefined && (e.data.end !== undefined || e.data.duration !== undefined)
    };
    var f = function (e, t, n) {
        var r = document.createElement("div");
        r.innerHTML = '<label for="checkbox-for-' + n + '" class="add-to-calendar-checkbox">+ Afegeix al meu calendari</label><br><br>';
        r.innerHTML += '<input name="add-to-calendar-checkbox" class="add-to-calendar-checkbox" id="checkbox-for-' + n + '" type="checkbox">';
        Object.keys(e).forEach(function (t) {
            r.innerHTML += e[t]
        });
        r.className = "add-to-calendar";
        if (t !== undefined) {
            r.className += " " + t
        }
        o();
        r.id = n;
        return r
    };
    var l = function (e) {
        if (e.options && e.options.class) {
            return e.options.class
        }
    };
    var c = function (e) {
        return e.options && e.options.id ? e.options.id : Math.floor(Math.random() * 1e6)
    };
    e.createCalendar = function (e) {
        if (!a(e)) {
            console.log("Event details missing.");
            return
        }
        return f(s(e.data), l(e), c(e))
    }
})(this);
